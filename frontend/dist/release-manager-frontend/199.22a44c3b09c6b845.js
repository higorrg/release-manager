"use strict";(self.webpackChunkrelease_manager_frontend=self.webpackChunkrelease_manager_frontend||[]).push([[199],{4199:(j,u,d)=>{d.r(u),d.d(u,{ReleaseDetailComponent:()=>M});var e=d(4438),g=d(177),p=d(2183),a=d(4341),f=d(7225);const b=(r,i)=>i.id,C=()=>[];function h(r,i){1&r&&(e.j41(0,"div",1),e.EFF(1,"Carregando..."),e.k0s())}function F(r,i){if(1&r&&(e.j41(0,"div",2),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.JRh(t.error())}}function v(r,i){if(1&r&&(e.j41(0,"option",15),e.EFF(1),e.k0s()),2&r){const t=i.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function x(r,i){if(1&r){const t=e.RV6();e.j41(0,"form",31),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.addClient())}),e.j41(1,"div",32)(2,"div",11)(3,"label",33),e.EFF(4,"C\xf3digo do Cliente:"),e.k0s(),e.nrm(5,"input",34),e.k0s(),e.j41(6,"div",11)(7,"label",35),e.EFF(8,"Ambiente:"),e.k0s(),e.j41(9,"select",36)(10,"option",14),e.EFF(11,"Selecione"),e.k0s(),e.j41(12,"option",37),e.EFF(13,"Homologa\xe7\xe3o"),e.k0s(),e.j41(14,"option",38),e.EFF(15,"Produ\xe7\xe3o"),e.k0s()()(),e.j41(16,"button",18),e.EFF(17," Adicionar "),e.k0s()()()}if(2&r){const t=e.XpG(2);e.Y8G("formGroup",t.clientForm),e.R7$(16),e.Y8G("disabled",!t.clientForm.valid||t.updating())}}function k(r,i){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td")(6,"button",39),e.bIt("click",function(){const o=e.eBV(t).$implicit,c=e.XpG(3);return e.Njj(c.removeClient(o.id))}),e.EFF(7," Remover "),e.k0s()()()}if(2&r){const t=i.$implicit;e.R7$(2),e.JRh(t.clientCode),e.R7$(2),e.JRh(t.environment)}}function E(r,i){if(1&r&&(e.j41(0,"table",29)(1,"thead")(2,"tr")(3,"th"),e.EFF(4,"C\xf3digo do Cliente"),e.k0s(),e.j41(5,"th"),e.EFF(6,"Ambiente"),e.k0s(),e.j41(7,"th"),e.EFF(8,"A\xe7\xf5es"),e.k0s()()(),e.j41(9,"tbody"),e.Z7z(10,k,8,2,"tr",null,b),e.k0s()()),2&r){let t;const n=e.XpG(2);e.R7$(10),e.Dyx((null==(t=n.release())?null:t.controlledClients)||e.lJ4(0,C))}}function P(r,i){1&r&&(e.j41(0,"p",30),e.EFF(1,"Nenhum cliente em controlado para esta release."),e.k0s())}function R(r,i){if(1&r){const t=e.RV6();e.j41(0,"div",3)(1,"h1"),e.EFF(2),e.k0s(),e.j41(3,"button",4),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.navigateBack())}),e.EFF(4,"Voltar"),e.k0s()(),e.j41(5,"div",5)(6,"section",6)(7,"h2"),e.EFF(8,"Informa\xe7\xf5es da Release"),e.k0s(),e.j41(9,"div",7)(10,"div",8)(11,"label"),e.EFF(12,"Produto:"),e.k0s(),e.j41(13,"span"),e.EFF(14),e.k0s()(),e.j41(15,"div",8)(16,"label"),e.EFF(17,"Vers\xe3o:"),e.k0s(),e.j41(18,"span"),e.EFF(19),e.k0s()(),e.j41(20,"div",8)(21,"label"),e.EFF(22,"Status Atual:"),e.k0s(),e.j41(23,"span"),e.EFF(24),e.k0s()(),e.j41(25,"div",8)(26,"label"),e.EFF(27,"Data de Cria\xe7\xe3o:"),e.k0s(),e.j41(28,"span"),e.EFF(29),e.k0s()(),e.j41(30,"div",8)(31,"label"),e.EFF(32,"\xdaltima Atualiza\xe7\xe3o:"),e.k0s(),e.j41(33,"span"),e.EFF(34),e.k0s()()()(),e.j41(35,"section",9)(36,"h2"),e.EFF(37,"Alterar Status"),e.k0s(),e.j41(38,"form",10),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateStatus())}),e.j41(39,"div",11)(40,"label",12),e.EFF(41,"Novo Status:"),e.k0s(),e.j41(42,"select",13)(43,"option",14),e.EFF(44,"Selecione um status"),e.k0s(),e.Z7z(45,v,2,2,"option",15,e.fX1),e.k0s()(),e.j41(47,"div",11)(48,"label",16),e.EFF(49,"Observa\xe7\xf5es:"),e.k0s(),e.j41(50,"textarea",17),e.EFF(51,"                "),e.k0s()(),e.j41(52,"button",18),e.EFF(53),e.k0s()()(),e.j41(54,"section",19)(55,"h2"),e.EFF(56,"Release Notes"),e.k0s(),e.j41(57,"form",10),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updateReleaseNotes())}),e.j41(58,"div",11)(59,"textarea",20),e.EFF(60,"                "),e.k0s()(),e.j41(61,"button",21),e.EFF(62," Salvar Release Notes "),e.k0s()()(),e.j41(63,"section",22)(64,"h2"),e.EFF(65,"Pr\xe9-requisitos"),e.k0s(),e.j41(66,"form",10),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.updatePrerequisites())}),e.j41(67,"div",11)(68,"textarea",23),e.EFF(69,"                "),e.k0s()(),e.j41(70,"button",21),e.EFF(71," Salvar Pr\xe9-requisitos "),e.k0s()()(),e.j41(72,"section",24)(73,"h2"),e.EFF(74,"Clientes em Controlado"),e.k0s(),e.j41(75,"div",25)(76,"button",26),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.showAddClient=!o.showAddClient)}),e.EFF(77," Adicionar Cliente "),e.k0s()(),e.DNE(78,x,18,2,"form",27),e.j41(79,"div",28),e.DNE(80,E,12,1,"table",29)(81,P,2,0,"p",30),e.k0s()()()}if(2&r){let t,n,o,c,m,_,l;const s=e.XpG();e.R7$(2),e.Lme("",null==(t=s.release())?null:t.product," - v",null==(t=s.release())?null:t.version,""),e.R7$(12),e.JRh(null==(n=s.release())?null:n.product),e.R7$(5),e.JRh(null==(o=s.release())?null:o.version),e.R7$(4),e.HbH("status-"+s.statusClass()),e.AVh("status",!0),e.R7$(),e.SpI(" ",null==(c=s.release())?null:c.status," "),e.R7$(5),e.JRh(s.formatDate(null==(m=s.release())?null:m.createdAt)),e.R7$(5),e.JRh(s.formatDate(null==(_=s.release())?null:_.updatedAt)),e.R7$(4),e.Y8G("formGroup",s.statusForm),e.R7$(7),e.Dyx(s.availableStatuses),e.R7$(7),e.Y8G("disabled",!s.statusForm.valid||s.updating()),e.R7$(),e.SpI(" ",s.updating()?"Atualizando...":"Atualizar Status"," "),e.R7$(4),e.Y8G("formGroup",s.releaseNotesForm),e.R7$(4),e.Y8G("disabled",!s.releaseNotesForm.dirty||s.updating()),e.R7$(5),e.Y8G("formGroup",s.prerequisitesForm),e.R7$(4),e.Y8G("disabled",!s.prerequisitesForm.dirty||s.updating()),e.R7$(8),e.vxM(s.showAddClient?78:-1),e.R7$(2),e.vxM(null!=(l=s.release())&&l.controlledClients&&(null!==(l=null==(l=s.release())||null==l.controlledClients?null:l.controlledClients.length)&&void 0!==l?l:0)>0?80:81)}}let M=(()=>{class r{route=(0,e.WQX)(p.nX);router=(0,e.WQX)(p.Ix);fb=(0,e.WQX)(a.ok);releaseService=(0,e.WQX)(f.p);release=(0,e.vPA)(null);loading=(0,e.vPA)(!0);error=(0,e.vPA)(null);updating=(0,e.vPA)(!1);showAddClient=!1;availableStatuses=["MR Aprovado","Falha no Build para Teste","Para Teste de Sistema","Reprovada no teste","Aprovada no teste","Falha no Build para Produ\xe7\xe3o","Para Teste Regressivo","Falha na instala\xe7\xe3o da Est\xe1vel","Interno","Revogada","Reprovada no teste regressivo","Aprovada no teste regressivo","Controlada","Dispon\xedvel"];statusForm=this.fb.group({status:["",a.k0.required],notes:[""]});releaseNotesForm=this.fb.group({releaseNotes:[""]});prerequisitesForm=this.fb.group({prerequisites:[""]});clientForm=this.fb.group({clientCode:["",a.k0.required],environment:["",a.k0.required]});statusClass=(0,e.EWP)(()=>{const t=this.release()?.status;return t?t.includes("Aprovad")?"approved":t.includes("Falha")||t.includes("Reprovad")?"failed":"pending":""});constructor(){(0,e.QZP)(()=>{const t=this.route.snapshot.params.id;t&&this.loadRelease(t)})}loadRelease(t){this.loading.set(!0),this.error.set(null),this.releaseService.getRelease(t).subscribe({next:n=>{this.release.set(n),this.releaseNotesForm.patchValue({releaseNotes:n.releaseNotes||""}),this.prerequisitesForm.patchValue({prerequisites:n.prerequisites||""}),this.loading.set(!1)},error:n=>{this.error.set("Erro ao carregar release: "+n.message),this.loading.set(!1)}})}updateStatus(){if(!this.statusForm.valid||!this.release())return;this.updating.set(!0);const{status:t,notes:n}=this.statusForm.value;this.releaseService.updateReleaseStatus(this.release().id,t,n||void 0).subscribe({next:o=>{this.release.set(o),this.statusForm.reset(),this.updating.set(!1)},error:o=>{this.error.set("Erro ao atualizar status: "+o.message),this.updating.set(!1)}})}updateReleaseNotes(){if(!this.releaseNotesForm.dirty||!this.release())return;this.updating.set(!0);const{releaseNotes:t}=this.releaseNotesForm.value;this.releaseService.updateReleaseNotes(this.release().id,t||"").subscribe({next:n=>{this.release.set(n),this.releaseNotesForm.markAsPristine(),this.updating.set(!1)},error:n=>{this.error.set("Erro ao atualizar release notes: "+n.message),this.updating.set(!1)}})}updatePrerequisites(){if(!this.prerequisitesForm.dirty||!this.release())return;this.updating.set(!0);const{prerequisites:t}=this.prerequisitesForm.value;this.releaseService.updatePrerequisites(this.release().id,t||"").subscribe({next:n=>{this.release.set(n),this.prerequisitesForm.markAsPristine(),this.updating.set(!1)},error:n=>{this.error.set("Erro ao atualizar pr\xe9-requisitos: "+n.message),this.updating.set(!1)}})}addClient(){if(!this.clientForm.valid||!this.release())return;this.updating.set(!0);const{clientCode:t,environment:n}=this.clientForm.value;this.releaseService.addControlledClient(this.release().id,t,n).subscribe({next:o=>{this.release.set(o),this.clientForm.reset(),this.showAddClient=!1,this.updating.set(!1)},error:o=>{this.error.set("Erro ao adicionar cliente: "+o.message),this.updating.set(!1)}})}removeClient(t){this.release()&&(this.updating.set(!0),this.releaseService.removeControlledClient(this.release().id,t).subscribe({next:n=>{this.release.set(n),this.updating.set(!1)},error:n=>{this.error.set("Erro ao remover cliente: "+n.message),this.updating.set(!1)}}))}navigateBack(){this.router.navigate(["/releases"])}formatDate(t){return t?new Date(t).toLocaleString("pt-BR"):"-"}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=e.VBU({type:r,selectors:[["app-release-detail"]],standalone:!0,features:[e.aNF],decls:4,vars:1,consts:[[1,"release-detail-container"],[1,"loading"],[1,"error"],[1,"release-header"],[1,"btn-back",3,"click"],[1,"release-content"],[1,"release-info"],[1,"info-grid"],[1,"info-item"],[1,"status-update"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","status"],["id","status","formControlName","status",1,"form-control"],["value",""],[3,"value"],["for","notes"],["id","notes","formControlName","notes","rows","3","placeholder","Adicione observa\xe7\xf5es sobre a mudan\xe7a de status (opcional)",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"release-notes"],["formControlName","releaseNotes","rows","6","placeholder","Digite as release notes...",1,"form-control"],["type","submit",1,"btn","btn-secondary",3,"disabled"],[1,"prerequisites"],["formControlName","prerequisites","rows","6","placeholder","Digite os pr\xe9-requisitos...",1,"form-control"],[1,"controlled-clients"],[1,"clients-header"],[1,"btn","btn-add",3,"click"],[1,"add-client-form",3,"formGroup"],[1,"clients-list"],[1,"clients-table"],[1,"no-clients"],[1,"add-client-form",3,"ngSubmit","formGroup"],[1,"form-row"],["for","clientCode"],["id","clientCode","type","text","formControlName","clientCode","placeholder","Ex: CLI001",1,"form-control"],["for","environment"],["id","environment","formControlName","environment",1,"form-control"],["value","homologacao"],["value","producao"],[1,"btn","btn-danger","btn-sm",3,"click"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.DNE(1,h,2,0,"div",1)(2,F,2,1,"div",2)(3,R,82,20),e.k0s()),2&n&&(e.R7$(),e.vxM(o.loading()?1:o.error()?2:o.release()?3:-1))},dependencies:[g.MD,a.X1,a.qT,a.xH,a.y7,a.me,a.wz,a.BC,a.cb,a.j4,a.JD],styles:[".release-detail-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;padding:40px;font-size:18px}.error[_ngcontent-%COMP%]{color:#dc3545}.release-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e0e0e0}.release-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#333}.btn-back[_ngcontent-%COMP%]{padding:8px 16px;background:#6c757d;color:#fff;border:none;border-radius:4px;cursor:pointer}.btn-back[_ngcontent-%COMP%]:hover{background:#5a6268}.release-content[_ngcontent-%COMP%]{display:grid;gap:30px}section[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 4px #0000001a}section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:20px;color:#495057;font-size:20px}.info-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.info-item[_ngcontent-%COMP%]{display:flex;flex-direction:column}.info-item[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#6c757d;margin-bottom:5px}.info-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#333}.status[_ngcontent-%COMP%]{padding:4px 12px;border-radius:4px;font-weight:500;display:inline-block}.status-approved[_ngcontent-%COMP%]{background:#d4edda;color:#155724}.status-pending[_ngcontent-%COMP%]{background:#fff3cd;color:#856404}.status-failed[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500;color:#495057}.form-control[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:14px}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;font-family:inherit}.btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color .2s}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn-primary[_ngcontent-%COMP%]{background:#007bff;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background:#6c757d;color:#fff}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a6268}.btn-danger[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.btn-danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#c82333}.btn-add[_ngcontent-%COMP%]{background:#28a745;color:#fff}.btn-add[_ngcontent-%COMP%]:hover{background:#218838}.btn-sm[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px}.clients-header[_ngcontent-%COMP%]{margin-bottom:20px}.add-client-form[_ngcontent-%COMP%]{background:#f8f9fa;padding:15px;border-radius:4px;margin-bottom:20px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr auto;gap:15px;align-items:end}.clients-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.clients-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .clients-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid #dee2e6}.clients-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8f9fa;font-weight:600;color:#495057}.clients-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8f9fa}.no-clients[_ngcontent-%COMP%]{color:#6c757d;text-align:center;padding:20px}"],changeDetection:0})}return r})()}}]);